<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AR Excursion: Italy â†’ Japan â†’ Iceland</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

  <!-- AR.js NFT tracking -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #msg {
      position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.55); padding: 10px 16px;
      color: white; border-radius: 6px; font-family: sans-serif;
    }
    #narrative {
      position: fixed; bottom: 20px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.75);
      color: white; padding: 16px 22px;
      border-radius: 10px;
      max-width: 80%;
      font-family: sans-serif;
      font-size: 15px;
      display: none;
    }
    #narrative.show { display: block; }
    #narrative strong { color: #00d0ff; }
  </style>
</head>

<body>

<div id="msg">Scan the Italy marker first.</div>
<div id="narrative">Welcome!</div>

<a-scene
  embedded
  renderer="colorManagement: true"
  arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled:false;"
>
  <a-entity camera></a-entity>

  <!-- 1 â€” ITALY -->
  <a-nft id="marker1" type="nft" url="https://raw.githubusercontent.com/liarinn/trm2/master/textures/italy/marker" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
    <a-gltf-model id="model1" src="models/colosseum.glb" scale="0.6 0.6 0.6" position="0 0 0" visible="false"></a-gltf-model>
  </a-nft>

  <!-- 2 â€” JAPAN -->
  <a-nft id="marker2" type="nft" url="https://raw.githubusercontent.com/liarinn/trm2/master/textures/japan/marker" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
    <!-- centered now, smaller scale -->
    <a-gltf-model id="model2" src="models/torii.glb" scale="0.5 0.5 0.5" position="0 0 0.05" rotation="-90 0 0" visible="false"></a-gltf-model>
  </a-nft>

  <!-- 3 â€” ICELAND -->
  <a-nft id="marker3" type="nft" url="https://raw.githubusercontent.com/liarinn/trm2/master/textures/iceland/marker" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
    <!-- give the box model an id and keep it hidden initially -->
    <a-box id="model3" color="red" scale="0.4 0.4 0.4" position="0 0 0.05" visible="false"></a-box>
  </a-nft>


</a-scene>

<script>
let seen1 = false;
let seen2 = false;

const msg = document.getElementById("msg");
const narrative = document.getElementById("narrative");

const model1 = document.getElementById("model1");
const model2 = document.getElementById("model2");
const model3 = document.getElementById("model3");

const m1 = document.getElementById("marker1");
const m2 = document.getElementById("marker2");
const m3 = document.getElementById("marker3");

function showOnly(model) {
  [model1, model2, model3].forEach(m => {
    if (!m) return;
    m.setAttribute("visible", m === model);
  });
}

function showNarrative(text) {
  narrative.innerHTML = text;
  narrative.classList.add("show");
}

/* ---- ITALY ---- */
m1.addEventListener("markerFound", () => {
  console.log("marker1 found");
  if (!seen1) {
    seen1 = true;
    showOnly(model1);
    msg.innerText = "Now scan the Japan marker.";
    showNarrative("<strong>Stop 1 â€” Rome</strong><br>The Colosseum welcomes you.");
  } else {
    // if already scanned, still show it and message
    showOnly(model1);
    msg.innerText = "Italy (returning view). Next: Japan.";
  }
});
m1.addEventListener("markerLost", () => {
  console.log("marker1 lost");
  if (model1) model1.setAttribute("visible", false);
  msg.innerText = "Italy marker lost.";
});

/* ---- JAPAN ---- */
m2.addEventListener("markerFound", () => {
  console.log("marker2 found");
  if (!seen1) {
    msg.innerText = "You must scan Italy first!";
    return;
  }
  if (!seen2) {
    seen2 = true;
    showOnly(model2);
    msg.innerText = "Now scan the Iceland marker.";
    showNarrative("<strong>Stop 2 â€” Japan</strong><br>The Torii gate symbolizes passage.");
  } else {
    showOnly(model2);
    msg.innerText = "Japan (returning view). Next: Iceland.";
  }
});
m2.addEventListener("markerLost", () => {
  console.log("marker2 lost");
  if (model2) model2.setAttribute("visible", false);
  msg.innerText = "Japan marker lost.";
});

/* ---- ICELAND ---- */
m3.addEventListener("markerFound", () => {
  console.log("marker3 found");
  if (!seen1 || !seen2) {
    msg.innerText = "Follow the route: Italy â†’ Japan â†’ Iceland.";
    return;
  }
  showOnly(model3);
  msg.innerText = "Excursion complete! ðŸŽ‰";
  showNarrative("<strong>Stop 3 â€” Iceland</strong><br>You stand among giant icebergs.");
});
m3.addEventListener("markerLost", () => {
  console.log("marker3 lost");
  if (model3) model3.setAttribute("visible", false);
  msg.innerText = "Iceland marker lost.";
});
</script>

</body>
</html>
