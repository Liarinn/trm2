<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AR Excursion: Italy â†’ Japan â†’ Iceland</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <!-- AR.js (NFT image tracking) -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #msg {
      position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.55); padding: 10px 16px;
      color: white; border-radius: 6px; font-family: sans-serif;
    }

    /* NEW: Narrative popup panel */
    #narrative {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.75);
      color: white;
      padding: 16px 22px;
      border-radius: 10px;
      max-width: 80%;
      font-family: sans-serif;
      font-size: 15px;
      display: none;
    }

    #narrative.show { display: block; }
    #narrative strong { color: #00d0ff; }
  </style>
</head>

<body>

<div id="msg">Scan the Italy marker first.</div>

<!-- NEW UI narrative panel -->
<div id="narrative">Welcome!</div>

<a-scene 
    embedded
    renderer="colorManagement: true"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
>

  <a-entity camera></a-entity>

  <!-- 1) ITALY MARKER -->
  <a-nft
    id="marker1"
    type="nft"
    url="textures/italy/marker"
    smooth="true"
    smoothCount="10"
    smoothTolerance="0.01"
    smoothThreshold="5"
  >
    <a-gltf-model 
      id="model1"
      src="models/colosseum.glb"
      rotation="0 0 0"
      scale="0.5 0.5 0.5"
      visible="false">
    </a-gltf-model>
  </a-nft>

  <!-- 2) JAPAN MARKER -->
  <a-nft
    id="marker2"
    type="nft"
    url="textures/japan/marker"
    smooth="true"
    smoothCount="10"
    smoothTolerance="0.01"
    smoothThreshold="5"
  >
    <a-gltf-model 
      id="model2"
      src="models/torii.glb"
      rotation="0 0 0"
      scale="0.5 0.5 0.5"
      visible="false">
    </a-gltf-model>
  </a-nft>

  <!-- 3) ICELAND MARKER (ICEBERGS NOW) -->
  <a-nft
    id="marker3"
    type="nft"
    url="textures/iceland/marker"
    smooth="true"
    smoothCount="10"
    smoothTolerance="0.01"
    smoothThreshold="5"
  >
    <a-gltf-model 
      id="model3"
      src="models/iceberg.glb"
      rotation="0 0 0"
      scale="0.5 0.5 0.5"
      visible="false">
    </a-gltf-model>
  </a-nft>

</a-scene>

<script>
// ---- ORDER CONTROL FLAGS ----
let seen1 = false;
let seen2 = false;

// ---- ELEMENTS ----
const msg = document.getElementById("msg");
const narrative = document.getElementById("narrative");

const m1 = document.getElementById("marker1");
const m2 = document.getElementById("marker2");
const m3 = document.getElementById("marker3");

const model1 = document.getElementById("model1");
const model2 = document.getElementById("model2");
const model3 = document.getElementById("model3");

// Helper that hides all models except the one we want to show
function showOnly(modelToShow) {
  [model1, model2, model3].forEach(m => m.setAttribute('visible', m === modelToShow));
}

// Helper to show narrative text
function showNarrative(text) {
  narrative.innerHTML = text;
  narrative.classList.add('show');
}

// ---- MARKER 1 (ITALY) ----
m1.addEventListener("markerFound", () => {
  if (!seen1) {
    seen1 = true;
    showOnly(model1);
    msg.innerText = "Now scan the Japan marker.";

    showNarrative("<strong>Stop 1 â€” Rome</strong><br>Colosseum, built AD 80. Tap to continue.");
  }
});

m1.addEventListener("markerLost", () => {
  model1.setAttribute('visible', false);
});

// ---- MARKER 2 (JAPAN) ----
m2.addEventListener("markerFound", () => {
  if (!seen1) {
    msg.innerText = "You must scan Italy first!";
    return;
  }
  if (!seen2) {
    seen2 = true;
    showOnly(model2);
    msg.innerText = "Now scan the Iceland marker.";

    showNarrative("<strong>Stop 2 â€” Japan</strong><br>The Torii gate. You feel the calm.");
  }
});

m2.addEventListener("markerLost", () => {
  model2.setAttribute('visible', false);
});

// ---- MARKER 3 (ICELAND â€” ICEBERGS) ----
m3.addEventListener("markerFound", () => {
  if (!seen1 || !seen2) {
    msg.innerText = "Follow the route: Italy â†’ Japan â†’ Iceland.";
    return;
  }

  showOnly(model3);
  msg.innerText = "Excursion complete! ðŸŽ‰";

  showNarrative("<strong>Stop 3 â€” Iceland</strong><br>Silent icebergs. Congratulations â€” you completed the excursion.");
});

m3.addEventListener("markerLost", () => {
  model3.setAttribute('visible', false);
});
</script>

</body>
</html>
